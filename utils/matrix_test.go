package utils

import (
	"fmt"
	"sort"
	"testing"

	"github.com/edaniels/test"
	"gonum.org/v1/gonum/mat"
)

func TestRotateMatrixAbout(t *testing.T) {
	var m mat.Dense
	vec2M := (*Vec2Matrix)(&m)
	rot := vec2M.RotateMatrixAbout(0, 0, 45)
	test.That(t, rot, test.ShouldEqual, vec2M)
}

func TestDistanceMSETo(t *testing.T) {
	data := []float64{0.6046602879796196, 0.6645600532184904, 0.4246374970712657, 0.06563701921747622, 0.09696951891448456, 0.5152126285020654, 0.21426387258237492, 0.31805817433032985, 0.28303415118044517, 0.6790846759202163, 0.20318687664732285, 0.5706732760710226, 0.29311424455385804, 0.7525730355516119, 0.865335013001561, 0.5238203060500009, 0.15832827774512764, 0.9752416188605784, 0.5948085976830626, 0.692024587353112, 0.17326623818270528, 0.544155573000885, 0.4231522015718281, 0.2535405005150605, 0.7886049150193449, 0.8805431227416171, 0.8943617293304537, 0.9769168685862624, 0.22228941700678773, 0.24151508854715265, 0.932846428518434, 0.8010550426526613, 0.18292491645390843, 0.8969919575618727, 0.9789293555766876, 0.09083727535388708, 0.9269868035744142, 0.3479539636282229, 0.7109071952999951, 0.6494894605929404, 0.7558235074915978, 0.13065111702897217, 0.8963417453962161, 0.7211477651926741, 0.08552050754191123, 0.6227283173637045, 0.2368225468054852, 0.18724610140105305, 0.6280981712183633, 0.28133029380535923, 0.43491247389145765, 0.5501469205077233, 0.7291807267342981, 0.0005138155161213613, 0.39998376285699544, 0.6039781022829275, 0.02967128127488647, 0.0028430411748625642, 0.5898341850049194, 0.8154051709333606, 0.4584424785756506, 0.02626515060968944, 0.24969320116349378, 0.24746660783662855, 0.5926237532124455, 0.6938381365172095, 0.539210105890946, 0.7507630564795985, 0.7531612777367586, 0.35576726540923664, 0.2318300419376769, 0.4983943012759756, 0.02519395979489504, 0.5893830864007992, 0.572086801443084, 0.4117626883450162, 0.49160739613162047, 0.7972085409108028, 0.7830349733960021, 0.1304138461737918, 0.7398257810158336, 0.09838378898573259, 0.09972966371993512, 0.07619026230375504, 0.15965092146489504, 0.32261068286779754, 0.5708516273454957, 0.6841751300974551, 0.524499759549865, 0.7163683749016712, 0.012825909106361078, 0.098030874806305, 0.826454125634742, 0.3443150177263606, 0.21647114665497036, 0.4020708452718306, 0.16867966833433606, 0.8279280961505588, 0.05792625966433577, 0.411540363220476, 0.7807540845584926, 0.05349462449440764, 0.2507622754291802, 0.9738818740706728, 0.021533783325605065, 0.09297015549992493, 0.31188554282705405, 0.4872392485803695, 0.6718291062346395, 0.9002751472643116, 0.31933126760711733, 0.4004323171418129, 0.6450388660194482, 0.33959675138730994, 0.23632747430436052, 0.035754647436084384, 0.6258366269581253, 0.07244835679235131, 0.8798448463057091, 0.8475002622646813, 0.24784452318699535, 0.07503721013465342, 0.6293316916453007, 0.6320034337887998, 0.014827369494876504, 0.06875619520215474, 0.6491884165984236, 0.8348057602192125, 0.6613931805833426, 0.31051027622482125, 0.967094341371773, 0.3095484505273281, 0.4173258421903824, 0.40673677545039083, 0.9581763626025936, 0.7916723090820832, 0.015181277223073395, 0.9047762370657334, 0.0429216421763342, 0.34785904313005395, 0.8399474211705598, 0.12436351859954159, 0.8349475064934941, 0.007681206474088089, 0.37026753645051064, 0.6432040265702031, 0.7911253356619845, 0.34686388037925503, 0.8220928971765717, 0.599194252505881, 0.41358098797631293, 0.911613706791599, 0.22891758676059876, 0.35076512764716117, 0.3038021298543657, 0.6715265504608378, 0.9631394012024704, 0.807941080954808, 0.9477602891945563, 0.9532587542503518, 0.1815908467575638, 0.8312410355437677, 0.8553103464769398, 0.27349475629159786, 0.9097612825191185, 0.4986324518556019, 0.9758952564996382, 0.044990698677957075, 0.9519061481203719, 0.5357909989896142, 0.8651749974832864, 0.5785509024958203, 0.5506157619831827, 0.5098654204729554, 0.49079401441435533, 0.2624906626498994, 0.3714866516582223, 0.4157519697339963, 0.9016276244796935, 0.2739245433510268, 0.8554484128929543, 0.9891320920320221, 0.1709460320883929, 0.5334514497811548, 0.8135907747765283, 0.2572075574213995, 0.33509436689927874, 0.0048797826077860845, 0.2295735886966574, 0.9499374071687937, 0.9626242011438862, 0.7126626121646726, 0.4075321048585774, 0.34746838606940983, 0.5975662051444081, 0.8328558555773872, 0.9367075689065375, 0.7203131001891496, 0.45015392507594826, 0.472492052251115, 0.36233147712894287, 0.04786834817976424, 0.7562101814022738, 0.2209988520356824, 0.39084244515115124, 0.14968548168959894, 0.7655885318342354, 0.4554439687670013, 0.08196946696466764, 0.26638179337652607, 0.09907017544018948, 0.15920356466786856, 0.6314765800673349, 0.9675052460215976, 0.3381810952188099, 0.8374659240734459, 0.502220808518761, 0.46303950236617286, 0.7440726180661482, 0.24841698197784662, 0.4237021994537764, 0.6568482587078144, 0.6367908945869619, 0.3868614372344463, 0.12636435926832457, 0.5113391781716151, 0.9946063668723257, 0.7273189933105949, 0.5140235687917202, 0.5456026338512396, 0.2932843538031215, 0.1417787687869967, 0.6313482346468529, 0.0014115440248851888, 0.8877920216386791, 0.5961786585231289, 0.8298384033630892, 0.06593483186524836, 0.33551802219817817, 0.6190296776466547, 0.32464410822828615, 0.08418688550119664, 0.6875681905604295, 0.022131132163735048, 0.07824573493651082, 0.22857519266973128, 0.27204487725166815, 0.6618300541680365, 0.968744565816411, 0.36440006309012346, 0.2061752842702243, 0.7664312698045661, 0.28790948593091775, 0.4522039282394723, 0.38905639165530426, 0.007528449185090612, 0.004489301491513168, 0.23784091936527604, 0.7931566165268344, 0.44009472089005885, 0.7840206765672978, 0.10218788555665104, 0.16385844085171358, 0.12119745631121061, 0.9983330793002129, 0.10328868330084902, 0.314590139237557, 0.14326690380198182, 0.6878038995433429, 0.03281587367327066, 0.33481839912544525, 0.348580055442631, 0.9147014220021253, 0.15845527169775636, 0.2631481339983502, 0.1889547442836859, 0.6413635631441661, 0.6283967430668859, 0.3369850819097053, 0.4282551326736735, 0.3467992512856615, 0.8049930454838599, 0.37729356339813386, 0.44730317876928205, 0.0988527767942791, 0.026524679327150302, 0.7834725514535928, 0.9751350581531069, 0.4426452337283921, 0.6124367528672799, 0.09649270985743633, 0.23819146822340934, 0.438007884259053, 0.2054626561542727, 0.47017894237198277, 0.08955778686501577, 0.018404037976305604, 0.9508283197764046, 0.5032641471128878, 0.5453866093820224, 0.2023124895049186, 0.9511724352303262, 0.9646698427464975, 0.27157696612578064, 0.2558710695632199, 0.18927726966121622, 0.3565376617022169, 0.6154037086366806, 0.7824416824349484, 0.7642632047982512, 0.1231719189615159, 0.5350412597731126, 0.2185698014148156, 0.6279724526238374, 0.45813301659344546, 0.8669360972460193, 0.4063892246730919, 0.4636380185527241, 0.6231305881147619, 0.3321902082191424, 0.7837430530219855, 0.7845907471751309, 0.30948957177885994, 0.05276331263182054, 0.38209306144499544, 0.29179316954369106, 0.42995718000771943, 0.3250813569198517, 0.41289957873852917, 0.7728096346359248, 0.13817455711021298, 0.3344156725529401, 0.6415758176907888, 0.5408426827578644, 0.4983312842605871, 0.06920886569024445, 0.41435144181497824, 0.9323084953168621, 0.7119294744517222, 0.15061104326485164, 0.6124508167986009, 0.6100933314746595, 0.08417161787544385, 0.7999475091803873, 0.10359242822311615, 0.49823676228315233, 0.944085605118216, 0.7851150701963044, 0.6135903952940208, 0.6154847981358815, 0.07226250660480299, 0.9105083434669217, 0.8606077665759194, 0.8337966240141702, 0.5781396810490688, 0.07879841835011174, 0.5504194817781458, 0.4786594588667231, 0.18038968874266706, 0.6582011134231887, 0.9405090880450124, 0.4377141871869802, 0.6868230728671094, 0.15651925473279124, 0.30091186058528707, 0.8136399609900968, 0.380657189299686, 0.4688898449024232, 0.29310185733681576, 0.21855305259276428, 0.360871416856906, 0.8624914374478864, 0.29708256355629153, 0.2065826619136986, 0.6967191657466347, 0.028303083325889995, 0.6072534395455154, 0.07945362337387198, 0.05912065131387529, 0.30152268100656, 0.5410998550087353, 0.27850762181610883, 0.5305857153507052, 0.28208099496492467, 0.3618054804803169, 0.2971122606397708, 0.09745461839911657, 0.07429099894984302, 0.6810783123925709, 0.31152244431052484, 0.741848959991823, 0.7302314772948083, 0.4283570818068078, 0.6826534880132438, 0.9222122589217269, 0.4931419977048804, 0.9549454404167818, 0.6908388315056789, 0.5637795958152644, 0.5517650490127749, 0.40380328579570035, 0.9859647293402467, 0.3220839705208817, 0.6445397825093294, 0.6695752976997745, 0.3696928436398219, 0.5352818906344061, 0.2388407028053186, 0.1267529293726013, 0.41032284435628247, 0.6250950283005304, 0.6236088264529301, 0.8305339189948062, 0.7360686014954314, 0.497868113342702, 0.40961827788499267, 0.0019038945142366389, 0.915821314612957, 0.559392449071014, 0.8780117586524, 0.6001655953233308, 0.8458327872480417, 0.641784290799583, 0.17365584472313275, 0.8143945509670211, 0.03032254783300687, 0.9756748149873165, 0.2940063127950149, 0.150964044979607, 0.8319308529698163, 0.6278346050000227, 0.08983608926036683, 0.3922161831540248, 0.9296116354490302, 0.5885763451434821, 0.5525803898142438, 0.9579539135375136, 0.10738111282075208, 0.3932509992288867, 0.19003276633920804, 0.6540414092312797, 0.5203802857122278, 0.15184340208190175, 0.3152080853201245, 0.13780406161952607, 0.5390745170394794, 0.5127817581110815, 0.6530402051353608, 0.654270134424146, 0.6366442140381798, 0.030682195787138565, 0.3691117091643448, 0.34768170859156955, 0.2529998236478441, 0.5550021356347942, 0.5064970636764183, 0.33136826030698385, 0.7002878731458151, 0.9991594902203332, 0.11167463676480495, 0.09211762444074219, 0.7146958158916296, 0.8486329209031569, 0.21256094905031958, 0.9451947603888259, 0.6458333745239767, 0.44846436394045647, 0.08247967651135, 0.40018828942364343, 0.9498832061012532, 0.4993854937524132, 0.01980867032545194, 0.42868843006993296, 0.8874475008505005, 0.7650082149332798, 0.7275772560415229, 0.5130875060878567, 0.7242290584591684, 0.9777634773577185, 0.8321979381499331, 0.9133990629364709, 0.8351038011543529, 0.7517405788967347, 0.09693421323873166, 0.5838347418625311, 0.9982738110084945, 0.9854655786332479, 0.33205608571906026, 0.9560206265966097, 0.1843906940020268, 0.8332418155281546, 0.8058717675376446, 0.7185304493527748, 0.8958032677441458, 0.018713221139656417, 0.423553153885841, 0.43269824007906393, 0.8557044145748864, 0.6590305330077544, 0.5034867900486911, 0.023109568410543832, 0.2611756191882184, 0.3148047959559753, 0.8997501257175273, 0.10019940926941497, 0.7698890899830834, 0.26238190747072776, 0.21465371537694145, 0.3511342996652132, 0.5783512569311121, 0.1198505089028631, 0.05378558010574821, 0.3241739630613883, 0.34928874777426255, 0.9687461599658117, 0.2079431283731565, 0.30220237504213365, 0.1340841627502418, 0.6408648211682538, 0.8098742259339521, 0.9427573715373733, 0.4946804357820598, 0.7107439118190982, 0.4076328718919816, 0.9443971387003045, 0.28863831012730923, 0.45258447627808124, 0.31536198151820755, 0.7515630824742361, 0.6697145888351075, 0.4588844539038894, 0.48152982184966137, 0.9506232438081543, 0.7425147296618299, 0.06615141487068936, 0.9254679440779998, 0.4094194000310731, 0.09726159973653944, 0.004444659798132893, 0.10930666111680035, 0.25705535663902546, 0.9264114223681271, 0.3038871248932524, 0.17648961347647024, 0.7051371238012589, 0.25036892046498466, 0.7512406316252606, 0.8409932064362602, 0.013285547727582237, 0.8993714646570142, 0.043000361954927006, 0.05109409825821224, 0.475697373996154, 0.04071993871109642, 0.26012467360309705, 0.9604975052982179, 0.2293202384473396, 0.756482324268764, 0.3389773883954362, 0.9859943600081704, 0.24965500730361836, 0.7897172155299953, 0.6574690455599712, 0.6575053763818192, 0.9192544999689806, 0.5203920220601794, 0.24818246016761236, 0.6997891424274157, 0.5122720329429057, 0.6220016345973344, 0.14057528768697503, 0.9440150975942463, 0.24579195449605964, 0.5369806159703968, 0.6716676406616031, 0.7338548372033181, 0.4234737796578878, 0.9530446527485383, 0.45518959189718156, 0.7198855627833396, 0.7425908573712917, 0.682521575399965, 0.24858283553819602, 0.7699709528045788, 0.2866377655128289, 0.19856153537434532, 0.6359532835253209, 0.4123154430150975, 0.1311899153799101, 0.8450350165079077, 0.7783038174399962, 0.6543795234077353, 0.39396524478154943, 0.5658666144424519, 0.4524828345917371, 0.6428353371366816, 0.8103801590743087, 0.08147470507461664, 0.49063473734720886, 0.6276587359645659, 0.7932145217370414, 0.2543257200511509, 0.4202173656755083, 0.21699679248744047, 0.5638443341393955, 0.36757356661613383, 0.900299766345919, 0.4451299089920236, 0.667613339955574, 0.006626965546730929, 0.782455054262922, 0.8082416219927049, 0.6099497178047082, 0.22650959076197102, 0.24686460113721356, 0.15347570862157847, 0.9092035473471718, 0.3272630685304311, 0.43029177967211024, 0.09960947545721176, 0.5220790936787113, 0.8482870257410837, 0.5654042126543889, 0.27535449617052216, 0.9292998432035774, 0.21087109674193696, 0.4724291506924252, 0.37547840737864574, 0.7879010097201398, 0.0963890594348332, 0.523107427839454, 0.18027178584513548, 0.36810106115736846, 0.09101785536353409, 0.3944866312415146, 0.7558532255910314, 0.3186824449914864, 0.2784447833137586, 0.5774681270476576, 0.11049024076434935, 0.3809836754593058, 0.8830369117118917, 0.17984592548596948, 0.1893724701430174, 0.1646351770617486, 0.6511740108138305, 0.183759416747548, 0.7312381165996661, 0.25125951839063504, 0.022463358900934063, 0.5000720043313008, 0.2810097094575801, 0.9154829851049563, 0.702914827930527, 0.9416776792342575, 0.7692554102175037, 0.09392256985342647, 0.0632202608191323, 0.797744931979739, 0.40473685055146047, 0.31816877565826934, 0.7912070123859711, 0.1660286029311165, 0.6496509866575767, 0.6164662013388623, 0.96042849606088, 0.9308120167007626, 0.6755204214103049, 0.06582839048524818, 0.7241292930553304, 0.8088521887446851, 0.5455248138303446, 0.050571327578438616, 0.6189388463813191, 0.472300900550716, 0.5670387879048848, 0.6080214484445662, 0.8544671050335831, 0.6947663381383937, 0.6917797275262825, 0.7888323936371067, 0.852016155104462, 0.027118954252390824, 0.17814602079049136, 0.7737291616975424, 0.37308960874062175, 0.21616470165894677, 0.5012675271840176, 0.2880752276001944, 0.24183011539986346, 0.5744830737306705, 0.055145272584174884, 0.17822265745369018, 0.6531595287075836, 0.2512089677286095, 0.6554169687050234, 0.25932343469081554, 0.02679770375645185, 0.8470474567561609, 0.14798565561009658, 0.7387964087793741, 0.8605926769895941, 0.4150779924271759, 0.21126747625859899, 0.2126205839936398, 0.1627235387727422, 0.8202179406328636, 0.2447240722097798, 0.2542048974310394, 0.2043277928270828, 0.525427196619863, 0.46556409529180914, 0.7835511023241203, 0.8979519762576306, 0.29421953857387145, 0.9775977087121448, 0.4242160149698978, 0.05683202156480986, 0.24076899686988937, 0.4165327185093328, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}
	left := mat.NewDense(3, 360, data)
	leftVec2 := (*Vec2Matrix)(left)
	dist := leftVec2.DistanceMSETo(leftVec2)
	test.That(t, dist, test.ShouldEqual, 0)

	rot := leftVec2.RotateMatrixAbout(0, 0, 0)
	dist = leftVec2.DistanceMSETo(rot)
	test.That(t, dist, test.ShouldEqual, 0)

	rot = leftVec2.RotateMatrixAbout(0, 0, 45)
	dist = leftVec2.DistanceMSETo(rot)
	test.That(t, dist, test.ShouldEqual, 0.7560178601305556)

	rot = leftVec2.RotateMatrixAbout(0, 0, 70)
	dist = leftVec2.DistanceMSETo(rot)
	test.That(t, dist, test.ShouldEqual, 0.7633847913096043)

	rot = leftVec2.RotateMatrixAbout(0, 0, 90)
	dist = leftVec2.DistanceMSETo(rot)
	test.That(t, dist, test.ShouldEqual, 0.7657411445029718)

	rot = leftVec2.RotateMatrixAbout(0, 0, 270)
	dist = leftVec2.DistanceMSETo(rot)
	test.That(t, dist, test.ShouldEqual, 1.207983341766853)

	rot = leftVec2.RotateMatrixAbout(0, 0, 360)
	dist = leftVec2.DistanceMSETo(rot)
	test.That(t, dist, test.ShouldEqual, 0)

	rot = leftVec2.RotateMatrixAbout(1, 1, 45)
	dist = leftVec2.DistanceMSETo(rot)
	test.That(t, dist, test.ShouldEqual, 0.4622326374440451)
}

func TestSortVec2Fs(t *testing.T) {
	for i, tc := range []struct {
		values   Vec2Fs
		expected Vec2Fs
	}{
		{nil, nil},
		{Vec2Fs{}, Vec2Fs{}},
		{Vec2Fs{[]float64{0, 0}}, Vec2Fs{[]float64{0, 0}}},
		{Vec2Fs{[]float64{0, 0}, []float64{1, 0}}, Vec2Fs{[]float64{0, 0}, []float64{1, 0}}},
		{Vec2Fs{[]float64{1, 0}, []float64{0, 0}}, Vec2Fs{[]float64{0, 0}, []float64{1, 0}}},
		{Vec2Fs{[]float64{0, 0}, []float64{1, 2}, []float64{1, 0}}, Vec2Fs{[]float64{0, 0}, []float64{1, 0}, []float64{1, 2}}},
	} {
		t.Run(fmt.Sprintf("%d", i), func(t *testing.T) {
			sort.Sort(tc.values)
			test.That(t, tc.values, test.ShouldResemble, tc.expected)
		})
	}
}
